#!/bin/bash

# This looks at a copy of the results.csv generated by
# validate-files.sh
# It only validates the files that failed before.
# This is useful when a large number of files were processed before and it'd
# be slow to reprocess all of them.
# It writes out to results.csv so you should clear out that file first.

# To be safe this also ignore files that don't have `"appName": "DG"`` and
# files that have `"appName": "CFM` just like the original script
grep ',fail$' results-1.csv | cut -d',' -f1 | \
xargs -n1 -I {} bash -c '
if grep -E -q "\"appName\": ?\"DG\"" "$1" && ! grep -E -q "\"appName\": ?\"CFM" "$1"; then
    if npm run validate "$1"; then
        echo "$1,pass" >> results.csv;
    else
        echo "$1,fail" >> results.csv;
    fi
fi' _ {}
