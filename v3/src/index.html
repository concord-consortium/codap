<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>CODAP V3</title>
    <meta name="description" content="CODAP is designed to support students in learning and doing data science, and as a tool for curriculum developers and education researchers.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Mono:ital,wght@0,100..900;1,100..900&family=Lato:ital,wght@0,100;0,300;0,400;0,700;0,900;1,100;1,300;1,400;1,700;1,900&display=swap" rel="stylesheet">
    <!-- TODO Load these fonts dynamically as needed. These are for translations -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@100..900&family=Noto+Sans+SC:wght@100..900&family=Noto+Sans+Thai:wght@100..900&family=Noto+Sans+Hebrew:wght@100..900&&family=Noto+Sans+Arabic:wght@100..900&&family=Noto+Sans+KR:wght@100..900&family=Noto+Sans+JP:wght@100..900&family=Noto+Sans:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <!-- TODO: Remove this when we're done with the beta button -->
    <link href="https://fonts.googleapis.com/css2?family=Gloria+Hallelujah&family=Montserrat:ital,wght@0,100..900;1,100..900&family=Noto+Color+Emoji&display=swap" rel="stylesheet">
    <!--
      The following is a link generated by the Adobe Fonts website https://fonts.adobe.com/fonts/museo-sans
      To generate the link, go to the website. You will have to sign up for an account.
      Find "Add to Web Project" in the upper right. Select all the relevant font sizes and styles.
      Create or add to a web project, and save. This will generate the link to use here.
    -->
    <link href="https://use.typekit.net/ckm7htd.css" rel="stylesheet" >
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-ZYRHG9RN3K"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-ZYRHG9RN3K');
    </script>
    <!-- Browser compatibility check - must run before main bundle -->
    <!-- This script uses ES5 syntax so it runs on older browsers -->
    <script>
      (function() {
        var isSupported = false;
        try {
          // Test for ES2020 features: optional chaining and nullish coalescing
          // These are syntax features that will throw SyntaxError in older browsers
          new Function('var obj = {}; return obj?.foo ?? "default"')();
          isSupported = true;
        } catch (e) {
          isSupported = false;
        }

        if (!isSupported) {
          // Replace the entire document to prevent the ES2020 bundle from loading
          var html = [
            '<!DOCTYPE html>',
            '<html style="height: 100%;">',
            '<head>',
            '<meta charset="UTF-8">',
            '<meta name="viewport" content="width=device-width, initial-scale=1.0">',
            '<title>CODAP - Browser Not Supported</title>',
            '<link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&display=swap" rel="stylesheet">',
            '<style>',
            'html, body { height: 100%; margin: 0; }',
            'body { display: flex; align-items: center; justify-content: center; background-color: #f5f5f5; font-family: Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; }',
            '.container { max-width: 600px; padding: 40px; background: white; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); text-align: center; margin: 20px; }',
            'h1 { color: #333; margin: 0 0 20px 0; font-size: 24px; }',
            'p { color: #666; line-height: 1.6; margin: 0 0 20px 0; }',
            'ul { color: #666; line-height: 1.8; text-align: left; margin: 0 0 20px 0; padding-left: 20px; }',
            '.footer { color: #999; font-size: 14px; margin: 0; }',
            'a { color: #0066cc; }',
            '</style>',
            '<\/head>',
            '<body>',
            '<div class="container">',
            '<h1>Browser Not Supported</h1>',
            '<p>CODAP requires a modern browser with ES2020 support. Your current browser does not meet the minimum requirements.</p>',
            '<p>Please update your browser to the latest version, or try one of these browsers:</p>',
            '<ul>',
            '<li>Google Chrome (version 80 or later)</li>',
            '<li>Mozilla Firefox (version 74 or later)</li>',
            '<li>Microsoft Edge (version 80 or later)</li>',
            '<li>Safari (version 13.1 or later)</li>',
            '</ul>',
            '<p class="footer">For more information, visit <a href="https://codap.concord.org/help/faqs/">codap.concord.org</a></p>',
            '</div>',
            '<\/body>',
            '<\/html>'
          ].join('');
          document.open();
          document.write(html);
          document.close();
          // Stop all further resource loading to prevent the main bundle from executing
          window.stop();
        }
      })();
    </script>
    <script>
      // Don't display the splash screen if the URL parameter "hideSplashScreen" is present
      // or if "componentMode" is enabled
      (function() {
        try {
          var params = new URLSearchParams(window.location.search);

          function booleanParam(paramName) {
            if (!params.has(paramName)) return false;
            var raw = params.get(paramName);
            var val = raw == null ? '' : String(raw).trim().toLowerCase();
            var isFalse = (val === 'false' || val === 'no' || val === '0');
            return !isFalse; // presence-only or any non-falsy value
          }

          var shouldHide = booleanParam('hideSplashScreen') || booleanParam('componentMode');
          if (shouldHide) {
            var style = document.createElement('style');
            style.textContent = '#splash-screen { display: none !important; }';
            document.head.appendChild(style);
          }
        } catch (e) {
          // ignore
        }
      })();
    </script>
  </head>
  <body>
    <%
     // We might want to add a slight delay to showing the splash screen otherwise it will flash even on a
     // fast load. Perhaps the delay should be 1s?
    %>
    <div id="splash-screen" class="modal">
      <div class="modal-background" style="z-index: 10; width: 100vw; height: 100vh;"></div>
      <div class="modal-content" style="z-index: 11; width: 100vw; height: 100vh;">
        <div class="modal-dialog">
          <div class="splash-container" style="position: relative;">
            <img src="<%= require('./assets/codap-splash-screen.png') %>"/>
            <% // in v2 the spinner did not show up right away there was a small delay %>
            <img src="<%= require('./assets/spinner.gif') %>" style="
              position: absolute;
              bottom: 5px;
              left: 50%;
              transform: translate(-50%, 0);
            "/>
          </div>
        </div>
      </div>
    </div>
    <div id="codap-app-id"></div>
  </body>
</html>
